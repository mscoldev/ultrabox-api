{"version":3,"file":"validateJWT.js","names":["require","response","request","jwt","User","validateJWT","req","res","next","url","tokenBearer","headers","authorization","split","status","json","msg","verify","process","env","SECRETORPRIVATEKEY","uid","dataToken","decode","console","log","findById","user","module","exports"],"sources":["../../src/middlewares/validateJWT.js"],"sourcesContent":["const { response, request } = require('express');\nconst jwt = require('jsonwebtoken');\n\nconst User = require('../models/user.model')\n\nconst validateJWT = async (req = request, res = response, next) => {\n    const url = req.url;\n    const tokenBearer = req.headers.authorization?.split(\" \")[1]\n\n    if (url == \"/api/auth/login\") {\n        next();\n    } else {\n        if (!tokenBearer) {\n            return res.status(401).json({ msg: 'Sin autorizaci√≥n: Su Token no es valido o debe registrarse antes de realizar la operacion.' });\n        }\n\n        try {\n            const { uid } = jwt.verify(tokenBearer, process.env.SECRETORPRIVATEKEY);\n            const dataToken = jwt.decode(tokenBearer, process.env.SECRETORPRIVATEKEY)\n            console.log(dataToken);\n            const user = await User.findById(uid)\n\n            req.user = user;\n\n            next();\n        } catch (error) {\n            res.status(403).json({ msg: 'Token no valido' })\n        }\n    }\n};\n\n\nmodule.exports = {\n    validateJWT,\n}"],"mappings":";;;;+CACA,oJ;;;;;;AADA,eAA8BA,OAAO,CAAC,SAAD,CAArC;AAAA,IAAQC,QAAR,YAAQA,QAAR;AAAA,IAAkBC,OAAlB,YAAkBA,OAAlB;;AACA,IAAMC,GAAG,GAAGH,OAAO,CAAC,cAAD,CAAnB;;AAEA,IAAMI,IAAI,GAAGJ,OAAO,CAAC,sBAAD,CAApB;;AAEA,IAAMK,WAAW;EAAA,sEAAG;IAAA;;IAAA;IAAA;IAAA;IAAA;IAAA;IAAA;IAAA;IAAA;IAAA;IAAA;;IAAA;MAAA;QAAA;UAAA;YAAOC,GAAP,2DAAaJ,OAAb;YAAsBK,GAAtB,2DAA4BN,QAA5B;YAAsCO,IAAtC;YACVC,GADU,GACJH,GAAG,CAACG,GADA;YAEVC,WAFU,4BAEIJ,GAAG,CAACK,OAAJ,CAAYC,aAFhB,0DAEI,sBAA2BC,KAA3B,CAAiC,GAAjC,EAAsC,CAAtC,CAFJ;;YAAA,MAIZJ,GAAG,IAAI,iBAJK;cAAA;cAAA;YAAA;;YAKZD,IAAI;YALQ;YAAA;;UAAA;YAAA,IAOPE,WAPO;cAAA;cAAA;YAAA;;YAAA,iCAQDH,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;cAAEC,GAAG,EAAE;YAAP,CAArB,CARC;;UAAA;YAAA;YAAA,cAYQb,GAAG,CAACc,MAAJ,CAAWP,WAAX,EAAwBQ,OAAO,CAACC,GAAR,CAAYC,kBAApC,CAZR,EAYAC,GAZA,eAYAA,GAZA;YAaFC,SAbE,GAaUnB,GAAG,CAACoB,MAAJ,CAAWb,WAAX,EAAwBQ,OAAO,CAACC,GAAR,CAAYC,kBAApC,CAbV;YAcRI,OAAO,CAACC,GAAR,CAAYH,SAAZ;YAdQ;YAAA,OAeWlB,IAAI,CAACsB,QAAL,CAAcL,GAAd,CAfX;;UAAA;YAeFM,IAfE;YAiBRrB,GAAG,CAACqB,IAAJ,GAAWA,IAAX;YAEAnB,IAAI;YAnBI;YAAA;;UAAA;YAAA;YAAA;YAqBRD,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;cAAEC,GAAG,EAAE;YAAP,CAArB;;UArBQ;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAAH;;EAAA,gBAAXX,WAAW;IAAA;EAAA;AAAA,GAAjB;;AA2BAuB,MAAM,CAACC,OAAP,GAAiB;EACbxB,WAAW,EAAXA;AADa,CAAjB"}