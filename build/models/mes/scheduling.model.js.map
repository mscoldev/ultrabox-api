{"version":3,"file":"scheduling.model.js","names":["require","Schema","model","now","moment","jsonata","scheduleSchema","qtyProduce","type","Number","required","action","String","dateStart","Date","validate","validator","v","test","message","min","dateEnd","status","_idProductionLine","ref","Types","ObjectId","_idRecipe","_idUser","_idClient","timestamps","versionKey","methods","toJSON","toObject","schedule","dateTimeScheduleStart","dateTimeScheduleEnd","format","hourStart","hourEnd","formatSchedule","JSONataExpression","dataPromise","expression","JSONataExp","result","evaluate","module","exports"],"sources":["../../../src/models/mes/scheduling.model.js"],"sourcesContent":["const { Schema, model, now } = require(\"mongoose\")\nconst moment = require(\"moment\");\nconst jsonata = require('jsonata');\n\nconst scheduleSchema = Schema({\n    qtyProduce: {\n        type: Number,\n        required: [true, 'Defina una cantidad a producir']\n    },\n    action: {\n        type: String,\n        required: [true, 'Define una acci√≥n para este registro'],\n    },\n    dateStart: {\n        type: Date,\n        required: [true, 'Define una fecha de inicio para el plan'],\n        validate: {\n            validator: function(v) {\n                return /\\S+/.test(v);\n            },\n            message: 'El campo name no puede estar en blanco'\n        },\n        default: now,\n        min: '2023-01-01'\n    },\n    dateEnd: {\n        type: Date,\n        required: [true, 'Define una fecha de fin para el plan'],\n        validate: {\n            validator: function(v) {\n                return /\\S+/.test(v);\n            },\n            message: 'El campo name no puede estar en blanco'\n        },\n        default: now,\n        min: '2023-01-01'\n    },\n    status: {\n        type: String,\n        required: [true, 'Define una estado para este registro'],\n    },\n    _idProductionLine: {\n        ref: 'ProductionLine',\n        type: Schema.Types.ObjectId\n    },\n    _idRecipe: {\n        ref: 'Recipe',\n        type: Schema.Types.ObjectId\n    },\n    _idUser: {\n        ref: 'User',\n        type: Schema.Types.ObjectId\n    },\n    _idClient: {\n        type: Schema.Types.ObjectId,\n        ref: 'ProductionLine',\n        required: false\n    },\n}, {\n    timestamps: true,\n    versionKey: false\n})\n\nscheduleSchema.methods.toJSON = function() {\n    const { dateStart, dateEnd, ...schedule } = this.toObject();\n    schedule.dateTimeScheduleStart = dateStart;\n    schedule.dateTimeScheduleEnd = dateEnd;\n    schedule.dateStart = moment(dateStart).format(\"YYYY-MM-DD\");\n    schedule.dateEnd = moment(dateEnd).format(\"YYYY-MM-DD\");\n    schedule.hourStart = moment(dateStart).format(\"HH:mm\");\n    schedule.hourEnd = moment(dateEnd).format(\"HH:mm\");\n\n    const formatSchedule = JSONataExpression(schedule)\n    return formatSchedule\n}\n\nfunction JSONataExpression(dataPromise) {\n    const expression = jsonata(JSONataExp);\n    const result = expression.evaluate(dataPromise);\n    return result;\n}\n\nconst JSONataExp = `$.{\n    \"_id\":_id,\n    \"qtyProduce\":qtyProduce,\n    \"action\":action,\n    \"status\":status,\n    \"dateTimeScheduleStart\":dateTimeScheduleStart,\n    \"dateTimeScheduleEnd\":dateTimeScheduleEnd,\n    \"dateStart\": dateStart,\n    \"dateEnd\": dateEnd,\n    \"hourStart\":hourStart,\n    \"hourEnd\": hourEnd,\n    \"productionLine\":{\n        \"_id\":_idProductionLine._id,\n        \"name\":_idProductionLine.name,\n        \"erp_code\":_idProductionLine.erp_code,\n        \"id_controller\":_idProductionLine.id_controller,\n        \"backgroundColor\": _idProductionLine.backgroundColor,\n        \"textColor\": _idProductionLine.textColor,\n        \"borderColor\": _idProductionLine.borderColor\n    },\n    \"recipe\":{\n        \"_id\":_idRecipe._id,\n        \"name\":_idRecipe.name,\n        \"erp_code\":_idRecipe.erp_code,\n        \"id_controller\":_idRecipe.id_controller,\n        \"productionLineUse\":_idRecipe.productionLineUse,\n        \"ingredients\":$._idRecipe.ingredients.$.{\n            \"_id\":_id,\n            \"_idMaterial\":_idMaterial._id,\n            \"name\":_idMaterial.name,\n            \"type\":_idMaterial.type,\n            \"unit\":{\n              \"_id\":unit._id,\n              \"name\":unit.name,\n              \"symbol\":unit.symbol\n            },\n            \"qty\":qty,\n            \"location\":{\n                \"_id\":_idLocation._id,\n                \"name\":_idLocation.name,\n                \"id_controller\":_idLocation.id_controller,\n                \"productionLineUse\":_idLocation.productionLineUse\n            }\n        }\n    },\n    \"user\":{\n        \"_id\":_idUser._id,\n        \"username\":_idUser.username\n    }\n}`\n\n\n\n\nmodule.exports = model('Schedule', scheduleSchema);"],"mappings":"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"}