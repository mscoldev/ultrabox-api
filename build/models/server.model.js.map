{"version":3,"file":"server.model.js","names":["require","config","path","express","cors","morgan","logErrors","errorHandler","boomErrorHandler","dbConnection","pgConnection","createRoles","createInitialConfApp","PORT","process","env","uploadPath","join","__dirname","staticUrl","corsOptions","credentials","preflightContinue","methods","optionsSuccessStatusCode","origin","Server","app","port","paths","conf","auth","recipe","material","production","productionLine","role","typesDocument","productionLog","location","scheduling","tools","graf","client","driver","product","site","truck","register","destination","weight","project","file","dbInitialize","middlewares","routes","middlewaresErrors","Promise","all","use","json","console","log","listen","module","exports"],"sources":["../../src/models/server.model.js"],"sourcesContent":["require('dotenv').config();\nconst path = require('path');\nconst express = require('express');\nconst cors = require('cors');\nconst morgan = require('morgan');\n\nconst { logErrors, errorHandler, boomErrorHandler } = require('../middlewares/error.handler');\nrequire('../helpers/auth')\nconst { dbConnection } = require('../database/config.database');\nconst { pgConnection } = require('../database/config.databasepg');\nconst { createRoles, createInitialConfApp } = require('../libs/initialSetupDatabase');\nconst PORT = process.env.PORT || 3000;\n\nconst uploadPath = path.join(__dirname, '..', '..', 'uploads');\nconst staticUrl = path.join(__dirname, '../public');\n\nconst corsOptions = {\n  credentials: false,\n  preflightContinue: false,\n  methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'],\n  optionsSuccessStatusCode: 204,\n  origin: '*'\n}\nclass Server {\n\n  constructor() {\n    this.app = express();\n    this.port = PORT;\n\n\n    this.paths = {\n      //*PATHS MES\n      conf: '/api/conf',\n      auth: '/api/auth',\n      recipe: '/api/recipe',\n      material: '/api/material',\n      production: '/api/production',\n      productionLine: '/api/productionline',\n      role: '/api/role',\n      typesDocument: '/api/typesDocument',\n      productionLog: '/api/mes/productionLog',\n      location: '/api/mes/location',\n      scheduling: '/api/mes/scheduling',\n      tools: '/api/mes/tools',\n\n\n      //*PATHS MES - GRAFICOS\n      graf: '/api/mes/graf',\n\n\n      //*PATHS SCALE\n      client: '/api/scale/client',\n      driver: '/api/scale/driver',\n      origin: '/api/scale/origin',\n      product: '/api/scale/product',\n      site: '/api/scale/site',\n      truck: '/api/scale/truck',\n      register: '/api/scale/register',\n      destination: '/api/scale/destination',\n      weight: '/api/scale/weight',\n\n      //*PATHS PROJECTS\n      project: '/api/project',\n\n      //*PATHS GENERALS\n      file: '/api/file'\n\n    }\n\n    //Conectar a la base de datos\n    this.dbInitialize();\n\n\n    // Middlewares\n    this.middlewares();\n\n    // Rutas de mi aplicaciÃ³n\n    this.routes();\n\n    this.middlewaresErrors();\n\n  }\n\n  //* Connect & Initialize Database\n\n  async dbInitialize() {\n    await Promise.all([\n      // pgConnection(),\n      dbConnection(),\n      createRoles(),\n      createInitialConfApp()\n    ])\n  }\n\n  // async connectToDatabase (){\n  //     await dbConnection();\n  // }\n\n  // async initialSetupDatabase (){\n  //     await createRoles();\n  // }\n\n  middlewares() {\n\n    // CORS\n    this.app.use(cors(corsOptions));\n\n    // this.app.use('/', express.static(process.cwd() + '/src/public'));\n\n    //Morgan\n    this.app.use(morgan('dev'));\n\n    // Lectura y parseo del body\n    this.app.use(express.json());\n\n    // Contenido Statico\n\n    this.app.use('/uploads', express.static(uploadPath));\n    console.log(staticUrl);\n    console.log(uploadPath);\n\n    // this.app.use(fileUpload({\n    //     useTempFiles: true,\n    //     tempFileDir: '/tmp/'\n    // }));\n\n  }\n\n  middlewaresErrors() {\n    //Error Handler\n    this.app.use(logErrors);\n    this.app.use(boomErrorHandler);\n    this.app.use(errorHandler);\n  }\n\n  routes() {\n    //*ROUTES APP MES\n    this.app.use(this.paths.conf, require('../routes/conf.routes'));\n\n    this.app.use(this.paths.auth, require('../routes/auth.routes'));\n    this.app.use(this.paths.recipe, require('../routes/mes/recipe.routes'));\n    this.app.use(this.paths.material, require('../routes/mes/material.routes'));\n    this.app.use(this.paths.production, require('../routes/mes/production.routes'));\n    this.app.use(this.paths.productionLine, require('../routes/mes/productionLine.routes'));\n    this.app.use(this.paths.role, require('../routes/mes/role.routes'));\n    this.app.use(this.paths.typesDocument, require('../routes/mes/typesDocument.routes'));\n    this.app.use(this.paths.productionLog, require('../routes/mes/productionLogs.routes'));\n    this.app.use(this.paths.location, require('../routes/mes/location.routes'));\n    this.app.use(this.paths.scheduling, require('../routes/mes/scheduling.routes'));\n    this.app.use(this.paths.tools, require('../routes/tools/units.routes'));\n\n    //*ROUTES APP MES - GRAFICOS\n\n    this.app.use(this.paths.graf, require('../routes/mes/query/graf.routes'));\n\n\n    //*ROUTES APP SCALE\n\n    this.app.use(this.paths.client, require('../routes/scale/client.routes'));\n    this.app.use(this.paths.driver, require('../routes/scale/driver.routes'));\n    this.app.use(this.paths.origin, require('../routes/scale/origin.routes'));\n    this.app.use(this.paths.product, require('../routes/scale/product.routes'));\n    this.app.use(this.paths.site, require('../routes/scale/site.routes'));\n    this.app.use(this.paths.truck, require('../routes/scale/truck.routes'));\n    this.app.use(this.paths.register, require('../routes/scale/register.routes'));\n    this.app.use(this.paths.destination, require('../routes/scale/destination.routes'));\n    this.app.use(this.paths.weight, require('../routes/scale/weight.routes'));\n\n    //*ROUTES APP PROJECT\n\n    this.app.use(this.paths.project, require('../routes/projects/projects.routes'));\n\n    //*ROUTER GENERAL\n    this.app.use(this.paths.file, require('../routes/files.routes'));\n\n  }\n\n  listen() {\n    this.app.listen(this.port, () => {\n      console.log('Server running on port: ', this.port);\n    });\n  }\n\n\n}\n\n\n\n\nmodule.exports = Server;"],"mappings":"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"}