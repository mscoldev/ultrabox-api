{"version":3,"file":"recipe.controller.js","names":["require","response","request","Recipe","jsonata","getRecipe","req","res","getRecipesToDatabase","recipesComplete","JSONataExpression","recipes","status","json","msg","message","createRecipe","body","recipe","ingredients","tempRecipe","save","recipeSaved","updateRecipe","paramsId","params","recipeId","findByIdAndUpdate","updatedRecipe","deleteRecipeById","deleted","deletedRecipe","find","populate","path","select","name","_id","type","erp_code","_idControllerMaterial","unit","exec","dataPromise","queryJSONata","expression","result","evaluate","module","exports"],"sources":["../../../src/controllers/mes/recipe.controller.js"],"sourcesContent":["const { response, request } = require('express');\nconst Recipe = require(\"../../models/recipe.model\");\nconst jsonata = require('jsonata');\n\n\nconst getRecipe = async (req = request, res = response) => {\n  try {\n    const recipesComplete = await getRecipesToDatabase()\n    const recipes = await JSONataExpression(recipesComplete)\n    res.status(200).json({\n      msg: 'Lista de recetas',\n      recipes,\n      recipesComplete\n    })\n  } catch (err) {\n    return res.status(500).json({ message: err.message });\n  }\n}\n\nconst createRecipe = async (req = request, res = response) => {\n  try {\n    //TODO: Usar desestructuracion de  objetos\n    const body = req.body;\n    const recipe = new Recipe(body)\n    const { ingredients, ...tempRecipe } = body;\n    // const recipe = new Recipe(tempRecipe);\n    // recipe.ingredients.push(ingredients);\n    const recipeSaved = await recipe.save();\n\n    res.status(200).json(\n      recipeSaved)\n  } catch (err) {\n    res.status(500).json({ message: err.message })\n  }\n}\n\nconst updateRecipe = async (req = request, res = response) => {\n  try {\n    const paramsId = req.params.recipeId;\n    const body = req.body;\n    const updatedRecipe = await Recipe.findByIdAndUpdate(paramsId, body, { new: true });\n    if (updatedRecipe != null) {\n      res.status(200).json({\n        msg: 'Receta actualizada por Id',\n        updatedRecipe\n      });\n    } else {\n      res.status(404).json({\n        msg: 'Receta no encontrada, verifique el Id ingresado'\n      })\n    }\n  } catch (err) {\n    return res.status(500).json({\n      message: err.message\n    })\n  }\n}\n\nconst deleteRecipeById = async (req = request, res = response) => {\n  try {\n    const paramsId = req.params.recipeId;\n    const body = { deleted: true }\n    const deletedRecipe = await Recipe.findByIdAndUpdate(paramsId, body);\n    if (deletedRecipe != null) {\n      res.status(202).json({\n        msg: 'Receta eliminada Id:' + paramsId\n      });\n    } else {\n      res.status(404).json({\n        msg: 'Material no encontrado, verifique el Id ingresado'\n      })\n    }\n  } catch (err) {\n    return res.status(500).json({ message: err.message })\n  }\n}\n\n//get Data to database mongo.\nconst getRecipesToDatabase = async () => {\n  try {\n    const recipes = await Recipe.find({ \"deleted\": false })\n      .populate({ path: 'ingredients._idMaterial', select: { name: 1, _id: 1, type: 1, deleted: 1, erp_code: 1, _idControllerMaterial: 1, unit: 1 } })\n      .populate({ path: 'productionLineUse', select: { name: 1 } })\n      .populate({ path: 'ingredients._idLocation' })\n      .exec();\n    return recipes;\n  } catch (err) {\n    message: err.message\n  }\n}\n\n//Function - List recipe apply a JSONata Expression\nconst JSONataExpression = async (dataPromise) => {\n  const queryJSONata = `[$.{\n      \"id\":_id,\n      \"name\":name,\n      \"erp_code\":erp_code,\n      \"_idControllerRecipe\":_idControllerRecipe,\n      \"temp\":temp,\n      \"deleted\":deleted,\n        \"productionLineUse\":[productionLineUse.$.{\n          \"_id\":_id,\n          \"name\":name}\n        ],\n        \"ingredients\":[ingredients.$.{\n          \"_idIngredient\":_id,\n          \"_idMaterial\":_idMaterial._id,\n          \"name\":_idMaterial.name,\n          \"_idControllerMaterial\":_idMaterial._idControllerMaterial,\n          \"type\":_idMaterial.type,\n          \"unit\":_idMaterial.unit,\n          \"deleted\":_idMaterial.deleted,\n          \"qty\":qty,\n          \"location\":_idLocation\n        }]\n      }]`;\n  const expression = jsonata(queryJSONata);\n\n  const result = expression.evaluate(dataPromise);\n  return result;\n}\n\n\nmodule.exports = { createRecipe, getRecipe, updateRecipe, deleteRecipeById }\n"],"mappings":"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"}